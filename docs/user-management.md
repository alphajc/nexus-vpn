# ç”¨æˆ·ç®¡ç†

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç» Nexus-VPN çš„ç”¨æˆ·ç®¡ç†åŠŸèƒ½ã€‚

## ç”¨æˆ·ç±»å‹

Nexus-VPN æ”¯æŒä¸‰ç§ç±»å‹çš„ç”¨æˆ·ï¼š

| ç±»å‹ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `v2ray` | VLESS-Reality ä»£ç†ç”¨æˆ· | éœ€è¦ä»£ç†ç¿»å¢™çš„åœºæ™¯ |
| `ikev2-cert` | IKEv2 è¯ä¹¦è®¤è¯ç”¨æˆ· | iOS/macOS è®¾å¤‡ï¼Œå®‰å…¨æ€§è¦æ±‚é«˜ |
| `ikev2-eap` | IKEv2 è´¦å·å¯†ç ç”¨æˆ· | Android/Windows è®¾å¤‡ï¼Œé…ç½®ç®€å• |

## æ·»åŠ ç”¨æˆ·

### æ·»åŠ  V2Ray ç”¨æˆ·

```bash
nexus-vpn user add --type v2ray --username <ç”¨æˆ·å>
```

**ç¤ºä¾‹**ï¼š

```bash
nexus-vpn user add --type v2ray --username alice
```

æ·»åŠ æˆåŠŸåï¼Œç”¨æˆ·ä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ UUIDï¼Œå¯é€šè¿‡ `user list` å‘½ä»¤æŸ¥çœ‹ã€‚

### æ·»åŠ  IKEv2 è¯ä¹¦ç”¨æˆ·

```bash
nexus-vpn user add --type ikev2-cert --username <ç”¨æˆ·å>
```

**ç¤ºä¾‹**ï¼š

```bash
nexus-vpn user add --type ikev2-cert --username bob
```

æ‰§è¡Œåä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ `<ç”¨æˆ·å>.mobileconfig` æ–‡ä»¶ï¼Œå¯ç›´æ¥å¯¼å…¥ iOS/macOS è®¾å¤‡ã€‚

**ç”Ÿæˆçš„æ–‡ä»¶**ï¼š
- `bob.mobileconfig` - Apple è®¾å¤‡é…ç½®æ–‡ä»¶ï¼ˆåŒ…å« CA è¯ä¹¦ã€ç”¨æˆ·è¯ä¹¦å’Œ VPN é…ç½®ï¼‰

**è¯ä¹¦å­˜å‚¨ä½ç½®**ï¼š
- ç”¨æˆ·è¯ä¹¦: `/etc/nexus-vpn/pki/certs/<ç”¨æˆ·å>.crt`
- ç”¨æˆ·ç§é’¥: `/etc/nexus-vpn/pki/private/<ç”¨æˆ·å>.key`
- P12 æ–‡ä»¶: `/etc/nexus-vpn/pki/certs/<ç”¨æˆ·å>.p12`

### æ·»åŠ  IKEv2 EAP ç”¨æˆ·

```bash
nexus-vpn user add --type ikev2-eap --username <ç”¨æˆ·å>
```

**ç¤ºä¾‹**ï¼š

```bash
nexus-vpn user add --type ikev2-eap --username charlie
```

ç³»ç»Ÿä¼šæç¤ºè¾“å…¥å¯†ç ï¼Œåˆ›å»ºæˆåŠŸåä¼šæ˜¾ç¤ºè¯¦ç»†çš„è¿æ¥ä¿¡æ¯ï¼š

```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IKEv2 EAP è¿æ¥ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼                                             â”‚
â”‚                                                            â”‚
â”‚ å®¢æˆ·ç«¯è¿æ¥è®¾ç½® (Android/Windows/iOS):                      â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                   â”‚
â”‚ æœåŠ¡å™¨ (Server):     203.0.113.10                          â”‚
â”‚ è¿œç¨‹ID (Remote ID):  203.0.113.10  <-- å¿…å¡«ï¼              â”‚
â”‚ ç”¨æˆ·å (Username):   charlie                               â”‚
â”‚ å¯†ç  (Password):     ********                              â”‚
â”‚ è®¤è¯ç±»å‹:            IKEv2 EAP (MSCHAPv2)                  â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                   â”‚
â”‚                                                            â”‚
â”‚ âš ï¸  é‡è¦æç¤º (Android 11+ / Windows):                      â”‚
â”‚ æ‚¨å¿…é¡»ä¸‹è½½å¹¶å®‰è£… CA æ ¹è¯ä¹¦ï¼Œå¦åˆ™è¿æ¥ä¼šå¤±è´¥ï¼               â”‚
â”‚                                                            â”‚
â”‚ CA è¯ä¹¦è·¯å¾„: /etc/nexus-vpn/pki/ca.crt                     â”‚
â”‚                                                            â”‚
â”‚ å¿«é€Ÿä¸‹è½½æ–¹å¼ (åœ¨æœ¬åœ°ç»ˆç«¯è¿è¡Œ):                             â”‚
â”‚ scp root@203.0.113.10:/etc/nexus-vpn/pki/ca.crt ./         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

## åˆ é™¤ç”¨æˆ·

### åˆ é™¤ V2Ray ç”¨æˆ·

```bash
nexus-vpn user del --type v2ray --username <ç”¨æˆ·å>
```

### åˆ é™¤ IKEv2 è¯ä¹¦ç”¨æˆ·

```bash
nexus-vpn user del --type ikev2-cert --username <ç”¨æˆ·å>
```

æ­¤æ“ä½œä¼šåˆ é™¤ï¼š
- ç”¨æˆ·è¯ä¹¦ (`.crt`)
- ç”¨æˆ·ç§é’¥ (`.key`)
- P12 æ–‡ä»¶ (`.p12`)
- mobileconfig æ–‡ä»¶

### åˆ é™¤ IKEv2 EAP ç”¨æˆ·

```bash
nexus-vpn user del --type ikev2-eap --username <ç”¨æˆ·å>
```

## åˆ—å‡ºç”¨æˆ·

```bash
nexus-vpn user list
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
ğŸŒ V2Ray ç”¨æˆ·
â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ç”¨æˆ·å   â”ƒ UUID                                 â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ admin    â”‚ 550e8400-e29b-41d4-a716-446655440000 â”‚
â”‚ alice    â”‚ 6ba7b810-9dad-11d1-80b4-00c04fd430c8 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ›¡ï¸ IKEv2 (è¯ä¹¦è®¤è¯) ç”¨æˆ·
â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”“
â”ƒ ç”¨æˆ·å   â”ƒ çŠ¶æ€    â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”©
â”‚ bob      â”‚ å·²ç­¾å‘  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ›¡ï¸ IKEv2 (è´¦å·å¯†ç ) ç”¨æˆ·
â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ç”¨æˆ·å   â”ƒ ç±»å‹      â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ charlie  â”‚ MSCHAPv2  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CA è¯ä¹¦ä½ç½®: /etc/nexus-vpn/pki/ca.crt
```

## æ‰¹é‡ç®¡ç†

### æ‰¹é‡æ·»åŠ ç”¨æˆ·è„šæœ¬ç¤ºä¾‹

```bash
#!/bin/bash
# batch_add_users.sh

# V2Ray ç”¨æˆ·åˆ—è¡¨
V2RAY_USERS=("user1" "user2" "user3")

# IKEv2 EAP ç”¨æˆ·åˆ—è¡¨ (ç”¨æˆ·å:å¯†ç )
EAP_USERS=("eap1:password1" "eap2:password2")

# æ·»åŠ  V2Ray ç”¨æˆ·
for user in "${V2RAY_USERS[@]}"; do
    nexus-vpn user add --type v2ray --username "$user"
done

# æ·»åŠ  EAP ç”¨æˆ·
for entry in "${EAP_USERS[@]}"; do
    user="${entry%%:*}"
    pass="${entry##*:}"
    echo "$pass" | nexus-vpn user add --type ikev2-eap --username "$user"
done
```

## è¯ä¹¦ç®¡ç†

### CA è¯ä¹¦ä½ç½®

```
/etc/nexus-vpn/pki/ca.crt
```

### å¯¼å‡º CA è¯ä¹¦

```bash
# å¤åˆ¶åˆ°å½“å‰ç›®å½•
sudo cp /etc/nexus-vpn/pki/ca.crt ./nexus-ca.crt

# é€šè¿‡ SCP ä¸‹è½½åˆ°æœ¬åœ°
scp root@<æœåŠ¡å™¨IP>:/etc/nexus-vpn/pki/ca.crt ./nexus-ca.crt
```

### è¯ä¹¦æœ‰æ•ˆæœŸ

- **CA è¯ä¹¦**: 10 å¹´ (3650 å¤©)
- **æœåŠ¡å™¨è¯ä¹¦**: 10 å¹´ (3650 å¤©)
- **ç”¨æˆ·è¯ä¹¦**: 10 å¹´ (3650 å¤©)

### P12 è¯ä¹¦å¯†ç 

æ‰€æœ‰ç”Ÿæˆçš„ P12 è¯ä¹¦ä½¿ç”¨ç»Ÿä¸€å¯†ç ï¼š`nexusvpn`

## é…ç½®æ–‡ä»¶ä½ç½®

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| Xray é…ç½® | `/usr/local/etc/xray/config.json` | V2Ray ç”¨æˆ·é…ç½® |
| IPsec é…ç½® | `/etc/ipsec.conf` | StrongSwan ä¸»é…ç½® |
| IPsec å¯†é’¥ | `/etc/ipsec.secrets` | EAP ç”¨æˆ·å‡­æ® |
| CA è¯ä¹¦ | `/etc/nexus-vpn/pki/ca.crt` | æ ¹è¯ä¹¦ |
| æœåŠ¡å™¨è¯ä¹¦ | `/etc/nexus-vpn/pki/certs/server.crt` | æœåŠ¡å™¨è¯ä¹¦ |
| ç”¨æˆ·è¯ä¹¦ç›®å½• | `/etc/nexus-vpn/pki/certs/` | ç”¨æˆ·è¯ä¹¦å­˜æ”¾ |
